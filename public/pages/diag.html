    <div class="container is-max-desktop px-4 py-4">
        <h1 class="title is-2 has-text-centered mb-6">YouTube Summarizer Diagnostics</h1>
        
        <div class="box mb-5">
            <h2 class="title is-4">Environment Information</h2>
            <div id="envInfo" class="content"></div>
        </div>

        <div class="box mb-5">
            <h2 class="title is-4">Provider Test</h2>
            <div id="providerStatus" class="mb-4"></div>
            <div class="field is-grouped">
                <div class="control is-expanded">
                    <div class="select is-fullwidth">
                        <select id="testProvider">
                            <option value="google">Google</option>
                            <option value="claude">Claude (Opus)</option>
                            <option value="haiku">Claude (Haiku)</option>
                            <option value="sonnet">Claude (Sonnet)</option>
                        </select>
                    </div>
                </div>
                <div class="control">
                    <button onclick="testProvider()" class="button is-primary">Test Provider</button>
                </div>
                <div class="control">
                    <button onclick="testAllProviders()" class="button is-info">Test All Providers</button>
                </div>
            </div>
            <div id="providerTests" class="mt-4"></div>
        </div>

        <div class="box mb-5">
            <h2 class="title is-4">Caption Test</h2>
            <div class="field is-grouped is-grouped-multiline">
                <div class="control is-expanded">
                    <input type="text" id="videoUrl" class="input" placeholder="Enter YouTube URL">
                </div>
                <div class="control">
                    <div class="select">
                        <select id="language">
                            <option value="en">English</option>
                            <option value="ar">Arabic</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                            <option value="ru">Russian</option>
                            <option value="zh">Chinese</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="field is-grouped mt-3">
                <div class="control">
                    <button onclick="testWithCustomVideo()" class="button is-primary">Test Custom Video</button>
                </div>
                <div class="control">
                    <button onclick="testAllLanguages()" class="button is-info">Test All Languages</button>
                </div>
                <div class="control">
                    <button onclick="testKnownVideo()" class="button is-success">Test Sample Video</button>
                </div>
            </div>
            <div class="columns is-multiline mt-4" id="captionStats"></div>
            <div id="captionTests" class="mt-4"></div>
        </div>

        <div class="box">
            <div class="level mb-3">
                <div class="level-left">
                    <h2 class="title is-4 mb-0">Debug Log</h2>
                </div>
                <div class="level-right">
                    <div class="buttons">
                        <button onclick="clearLog()" class="button is-small">Clear Log</button>
                        <button onclick="copyLog()" class="button is-small">Copy Log</button>
                    </div>
                </div>
            </div>
            <div id="debugLog" class="has-background-white-ter p-3" style="max-height: 400px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>

        // Debug logging
        function log(message, type = 'info') {
            const debugLog = document.getElementById('debugLog');
            const entry = document.createElement('div');
            entry.className = `notification is-${type} is-light mb-2 py-2 px-3`;
            const timestamp = new Date().toISOString();
            entry.innerHTML = `<span class="has-text-grey-light">${timestamp}</span> ${message}`;
            debugLog.appendChild(entry);
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        // Copy log contents
        function copyLog() {
            const debugLog = document.getElementById('debugLog');
            const text = debugLog.innerText;
            navigator.clipboard.writeText(text).then(() => {
                log('Log copied to clipboard', 'success');
            });
        }

        // Clear log
        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
            log('Log cleared', 'info');
        }

        // Environment Info
        function showEnvironmentInfo() {
            const container = document.getElementById('envInfo');
            const info = {
                url: window.location.href,
                userAgent: navigator.userAgent,
                screenResolution: `${window.screen.width}x${window.screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                timestamp: new Date().toISOString()
            };
            
            container.innerHTML = `<pre class="has-background-white-ter p-3">${JSON.stringify(info, null, 2)}</pre>`;
            log('Environment info loaded', 'info');
        }

        // Provider Status
        async function updateProviderStatus() {
            const settings = JSON.parse(localStorage.getItem('apiSettings')) || {};
            const container = document.getElementById('providerStatus');
            
            container.innerHTML = `
                <div class="level mb-2">
                    <div class="level-left">
                        <div class="level-item">
                            <span class="tag ${settings.googleApiKey ? 'is-success' : 'is-danger'} is-medium">
                                Google API Key: ${settings.googleApiKey ? 'Configured' : 'Not Configured'}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="level mb-2">
                    <div class="level-left">
                        <div class="level-item">
                            <span class="tag ${settings.claudeApiKey ? 'is-success' : 'is-danger'} is-medium">
                                Claude API Key: ${settings.claudeApiKey ? 'Configured' : 'Not Configured'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Test Provider
        async function testProvider() {
            const provider = document.getElementById('testProvider').value;
            const settings = JSON.parse(localStorage.getItem('apiSettings')) || {};
            const result = addResult('providerTests', `Testing ${provider} provider...`);
            
            try {
                const headers = {
                    'Content-Type': 'application/json'
                };

                if (provider === 'google' && settings.googleApiKey) {
                    headers['X-API-Key'] = settings.googleApiKey;
                } else if (['claude', 'haiku', 'sonnet'].includes(provider) && settings.claudeApiKey) {
                    headers['X-API-Key'] = settings.claudeApiKey;
                }

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        message: 'Hello, this is a test message.',
                        captions: 'This is a test caption.',
                        provider
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Provider test failed');
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let finalResponse = null;

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.slice(6));
                            if (data.type === 'final') {
                                finalResponse = data;
                            }
                        }
                    }
                }

                if (finalResponse) {
                    updateResult(result, `
                        <div class="notification is-success is-light">
                            <p class="mb-2">✅ ${provider} test successful</p>
                            <pre class="has-background-white p-3">${finalResponse.markdown || finalResponse.html}</pre>
                        </div>
                    `, 'success');
                    log(`${provider} test successful`, 'success');
                } else {
                    throw new Error('No final response received');
                }
            } catch (error) {
                log(`${provider} test failed: ${error.message}`, 'danger');
                updateResult(result, `
                    <div class="notification is-danger is-light">
                        ❌ ${provider} test failed: ${error.message}
                    </div>
                `, 'error');
            }
        }

        // Test All Providers
        async function testAllProviders() {
            const providers = ['google', 'claude', 'haiku', 'sonnet'];
            for (const provider of providers) {
                document.getElementById('testProvider').value = provider;
                await testProvider();
            }
        }

        // Extract video ID from URL
        function extractVideoId(url) {
            const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
            return match ? match[1] : null;
        }

        // Update caption statistics
        function updateCaptionStats(captions) {
            const stats = document.getElementById('captionStats');
            const lines = captions.split('\n');
            const words = captions.split(/\s+/).length;
            const chars = captions.length;
            
            stats.innerHTML = `
                <div class="column is-4">
                    <div class="box has-text-centered">
                        <p class="heading">Lines</p>
                        <p class="title">${lines.length}</p>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-centered">
                        <p class="heading">Words</p>
                        <p class="title">${words}</p>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-centered">
                        <p class="heading">Characters</p>
                        <p class="title">${chars}</p>
                    </div>
                </div>
            `;
        }

        // Test with custom video
        async function testWithCustomVideo() {
            const url = document.getElementById('videoUrl').value;
            const lang = document.getElementById('language').value;
            const videoId = extractVideoId(url);
            
            if (!videoId) {
                log('Invalid YouTube URL', 'danger');
                return;
            }

            log(`Testing custom video ID: ${videoId}, Language: ${lang}`, 'info');
            await testCaptions(videoId, lang);
        }

        // Test all languages for a video
        async function testAllLanguages() {
            const url = document.getElementById('videoUrl').value;
            const videoId = extractVideoId(url);
            
            if (!videoId) {
                log('Invalid YouTube URL', 'danger');
                return;
            }

            const languages = ['en', 'ar', 'es', 'fr', 'de', 'ja', 'ko', 'ru', 'zh'];
            log(`Testing all languages for video ID: ${videoId}`, 'info');
            
            for (const lang of languages) {
                await testCaptions(videoId, lang);
            }
        }

        // Test with known video
        async function testKnownVideo() {
            const videoId = 'dQw4w9WgXcQ'; // Rick Astley - Never Gonna Give You Up
            const lang = document.getElementById('language').value;
            
            log(`Testing sample video with ID: ${videoId}, Language: ${lang}`, 'info');
            await testCaptions(videoId, lang);
        }

        // Test captions for a specific video and language
        async function testCaptions(videoId, language) {
            const result = addResult('captionTests', `Testing captions for video ID: ${videoId}, Language: ${language}...`);
            
            try {
                log(`Fetching captions from server`, 'info');
                const startTime = performance.now();
                
                const response = await fetch(`/api/captions/${videoId}?lang=${language}&auto=true&timestamps=true`);
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.details || 'Failed to fetch captions');
                }
                
                const captions = await response.text();
                const endTime = performance.now();
                
                if (captions) {
                    const preview = captions.split('\n').slice(0, 5).join('\n');
                    updateResult(result, `
                        <div class="notification is-success is-light">
                            <p class="mb-2">✅ Successfully fetched captions for ${language} (${(endTime - startTime).toFixed(2)}ms)</p>
                            <pre class="has-background-white p-3">${preview}...</pre>
                            <button onclick="showFullCaptions('${encodeURIComponent(captions)}')" class="button is-small is-info mt-3">Show Full Captions</button>
                        </div>
                    `, 'success');
                    log(`Successfully retrieved ${captions.length} characters of captions`, 'success');
                    updateCaptionStats(captions);
                }
            } catch (error) {
                log(`Error fetching captions: ${error.message}`, 'danger');
                updateResult(result, `
                    <div class="notification is-danger is-light">
                        ❌ Error: ${error.message}
                    </div>
                `, 'error');
            }
        }

        // Show full captions in a modal
        function showFullCaptions(encodedCaptions) {
            const captions = decodeURIComponent(encodedCaptions);
            const modal = document.createElement('div');
            modal.className = 'modal is-active';
            modal.innerHTML = `
                <div class="modal-background"></div>
                <div class="modal-card">
                    <header class="modal-card-head">
                        <p class="modal-card-title">Full Captions</p>
                        <button class="delete" aria-label="close" onclick="this.closest('.modal').remove()"></button>
                    </header>
                    <section class="modal-card-body">
                        <pre class="has-background-white-ter p-3">${captions}</pre>
                    </section>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Utility functions
        function addResult(containerId, message, type = 'pending') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `notification is-info is-light`;
            div.innerHTML = message;
            container.insertBefore(div, container.firstChild);
            return div;
        }

        function updateResult(element, message, type) {
            element.innerHTML = message;
        }

        // Initialize on page load
        window.onload = () => {
            showEnvironmentInfo();
            updateProviderStatus();
            document.getElementById('videoUrl').value = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
            log('Diagnostic page initialized', 'info');
        };
    </script>
