# YouTube Video Summarizer - API Documentation

## API Overview

The YouTube Video Summarizer provides a RESTful API for integrating video caption extraction and AI-powered summarization into your applications. This documentation covers all available endpoints, authentication, error handling, and best practices.

## Important Note on Caption Retrieval

⚠️ **CRITICAL**: YouTube caption retrieval MUST be performed client-side (in the browser) to comply with YouTube's terms of service and avoid blocking. The `/captions` endpoint documented below is for reference only and should NOT be used for server-side caption retrieval. Instead, use the provided client-side JavaScript implementation in `public/js/youtube-captions.js`.

Attempting server-side caption retrieval may result in:
- IP address blocking by YouTube
- Rate limiting issues
- Service disruptions
- Terms of service violations

## Base URL
All API endpoints are relative to: `http://localhost:3000/api`

## Authentication
Currently, the API operates without authentication for local development. For production deployment, implement appropriate authentication mechanisms (JWT, API keys, etc.).

## Rate Limiting
Default limits:
- 100 requests per hour per IP
- 5 concurrent requests per IP
- Burst: 10 requests per minute

## API Endpoints

### 1. Caption Extraction (Client-Side Implementation)

The following endpoint documentation is provided for reference only. In practice, caption extraction MUST be implemented client-side using the provided JavaScript utilities.

**Client-Side Implementation:**
```javascript
// Use the provided youtube-captions.js implementation
import { fetchCaptions } from './youtube-captions.js';

// Example usage
const captions = await fetchCaptions(videoId, {
    language: 'en',
    allowAuto: false
});
```

#### Get Video Captions (Reference Only)
**Endpoint:** `GET /captions/:videoId`

**Parameters:**
- `videoId` (path, required): YouTube video identifier
- `lang` (query, optional): Language code (default: 'en')
- `auto` (query, optional): Allow auto-generated captions (default: false)
- `format` (query, optional): Response format ('text'|'json'|'srt', default: 'json')

**Success Response:**
```json
{
    "videoId": "dQw4w9WgXcQ",
    "language": "en",
    "isAutoGenerated": false,
    "captions": {
        "text": "Full caption text...",
        "segments": [
            {
                "start": 0.0,
                "end": 2.5,
                "text": "Caption segment..."
            }
        ]
    },
    "metadata": {
        "duration": "3:32",
        "title": "Video Title",
        "language": "en"
    }
}
```

### 2. AI Summarization

#### Generate Summary
Processes video captions through the AI service to generate a summary.

**Endpoint:** `POST /chat`

**Request Headers:**
- Content-Type: application/json
- Accept: text/event-stream

**Request Body:**
```json
{
    "message": "Summarize this video",
    "captions": "Video caption text...",
    "options": {
        "maxLength": 500,
        "format": "markdown",
        "style": "concise",
        "language": "en"
    }
}
```

**Example Request:**
```bash
curl -X POST "http://localhost:3000/api/chat" \
     -H "Content-Type: application/json" \
     -H "Accept: text/event-stream" \
     -d '{
         "message": "Summarize this video",
         "captions": "Video caption text...",
         "options": {
             "maxLength": 500,
             "format": "markdown"
         }
     }'
```

**Response Stream Events:**

Progress Update:
```javascript
data: {
    "type": "chunk",
    "content": "Generated text chunk...",
    "progress": 25,
    "timestamp": "2024-01-20T10:15:30Z"
}
```

Final Response:
```javascript
data: {
    "type": "final",
    "content": "Complete summary text...",
    "metadata": {
        "tokens": 450,
        "processingTime": "2.5s",
        "model": "KoboldCPP"
    }
}
```

Error Event:
```javascript
data: {
    "type": "error",
    "error": "AI service unavailable",
    "code": "AI_SERVICE_ERROR",
    "timestamp": "2024-01-20T10:15:30Z"
}
```

### 3. System Health

#### Health Check
Monitors the status of all system components.

**Endpoint:** `GET /health`

**Example Request:**
```bash
curl "http://localhost:3000/api/health"
```

**Success Response:**
```json
{
    "status": "healthy",
    "timestamp": "2024-01-20T10:15:30Z",
    "components": {
        "server": {
            "status": "healthy",
            "uptime": "2h 15m",
            "version": "1.0.0"
        },
        "ai_service": {
            "status": "healthy",
            "model": "KoboldCPP",
            "responseTime": "150ms"
        },
        "youtube_api": {
            "status": "healthy",
            "quota": {
                "remaining": 8500,
                "reset": "2024-01-21T00:00:00Z"
            }
        }
    }
}
```

## Performance Optimization

### Caching Strategy
- Implement client-side caching using ETags
- Cache video captions with a TTL of 24 hours
- Use Redis for server-side caching of frequent requests

Example Cache Headers:
```http
Cache-Control: public, max-age=86400
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"
```

### Request Optimization
1. Use compression for large responses
2. Implement pagination for long captions
3. Use streaming responses for real-time updates
4. Batch related requests when possible

### Response Optimization
1. Minimize payload size
2. Use appropriate content encoding
3. Implement partial responses
4. Support conditional requests

## Security Considerations

### API Security Checklist
1. Implement rate limiting
2. Validate all input parameters
3. Sanitize response data
4. Use HTTPS in production
5. Implement request signing
6. Add API key authentication
7. Monitor for abuse patterns

### Input Validation
- Validate video IDs against regex: `^[a-zA-Z0-9_-]{11}$`
- Sanitize language codes
- Validate numeric parameters
- Check content length limits

### Error Handling Best Practices
1. Use standard HTTP status codes
2. Include detailed error messages
3. Add error codes for automation
4. Log errors with context
5. Implement retry mechanisms

## Integration Examples

### Node.js Client (Client-Side Only)
```javascript
// Import the provided client-side implementation
import { fetchCaptions } from './public/js/youtube-captions.js';

const getCaptions = async (videoId, options = {}) => {
    try {
        const captions = await fetchCaptions(videoId, {
            language: options.language || 'en',
            allowAuto: options.allowAuto || false
        });
        return captions;
    } catch (error) {
        console.error('Caption retrieval error:', error);
        throw error;
    }
};
```

### Python Client (For AI Summary Only)
```python
import requests

def get_summary(captions, language='en'):
    url = "http://localhost:3000/api/chat"
    
    data = {
        "message": "Summarize this video",
        "captions": captions,
        "options": {
            "language": language
        }
    }
    
    response = requests.post(url, json=data)
    response.raise_for_status()
    
    return response.json()
```

## Troubleshooting

### Common Issues
1. Rate limit exceeded
2. Invalid video ID format
3. Captions not available
4. AI service timeout
5. Network connectivity

### Resolution Steps
1. Check API status
2. Verify input parameters
3. Review error messages
4. Check system logs
5. Validate configuration
